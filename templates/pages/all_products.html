<!-- pages/all_products.html -->
{% extends '_base.html' %}
{% load static %}

{% block body %}
{% include 'include/navbar.html' %}

<div id="hiddenBlock" class="hidden-block">
    {% include 'include/cart.html' %}
</div>

<div class="all-products">
    <div class="all-products-content">

        <div class="all-filter">
            <div class="all-filter-item">
                <div class="all-filter-item-title">BRANDS</div>
                <ul class="desktop-filter">
                    <li><a href="?">All</a></li>
                    {% for brand_id, brand_name in unique_brands %}
                    <li><a href="?brand={{ brand_id }}{% if request.GET.subcategory %}&subcategory={{ request.GET.subcategory }}{% endif %}">{{ brand_name }}</a></li>
                    {% endfor %}
                </ul>
                <ul class="swiper-container scrolling-container mobile-filter">
                    <div class="swiper-wrapper">
                        {% for brand_id, brand_name in unique_brands %}
                        <div class="swiper-slide element"><a href="?brand={{ brand_id }}{% if request.GET.subcategory %}&subcategory={{ request.GET.subcategory }}{% endif %}">{{ brand_name }}</a></div>
                        {% endfor %}
                    </div>
                </ul>
            </div>
            <div class="all-filter-item">
                <div class="all-filter-item-title">SUBCATEGORIES</div>
                <ul class="desktop-filter">
                    <li><a href="?">All</a></li>
                    {% for subcategory_id, subcategory_name in unique_subcategories %}
                    <li><a href="?subcategory={{ subcategory_id }}{% if request.GET.brand %}&brand={{ request.GET.brand }}{% endif %}">{{ subcategory_name }}</a></li>
                    {% endfor %}
                </ul>
                <ul class="swiper-container scrolling-container mobile-filter">
                    <div class="swiper-wrapper">
                        {% for subcategory_id, subcategory_name in unique_subcategories %}
                        <div class="swiper-slide element"><a href="?subcategory={{ subcategory_id }}{% if request.GET.brand %}&brand={{ request.GET.brand }}{% endif %}">{{ subcategory_name }}</a></div>
                        {% endfor %}
                    </div>
                </ul>
            </div>
        </div>

        <div style="width: 100%;">
             <div class="sorting-buttons">
                <label class="dropdown">
                    <div class="dd-button">
                          Sort products
                    </div>

                    <input type="checkbox" class="dd-input" id="test">

                      <ul class="dd-menu">
                        <li>
                           <a href="?sort_by=price_asc{% if request.GET.brand %}&brand={{ request.GET.brand }}{% endif %}{% if request.GET.subcategory %}&subcategory={{ request.GET.subcategory }}{% endif %}">Low to High</a>
                        </li>
                        <li>
                           <a href="?sort_by=price_desc{% if request.GET.brand %}&brand={{ request.GET.brand }}{% endif %}{% if request.GET.subcategory %}&subcategory={{ request.GET.subcategory }}{% endif %}">High to Low</a>
                        </li>
                        <li>
                             <a href="?sort_by=date_added{% if request.GET.brand %}&brand={{ request.GET.brand }}{% endif %}{% if request.GET.subcategory %}&subcategory={{ request.GET.subcategory }}{% endif %}">Sort by Date Added</a>
                        </li>
                      </ul>

                </label>

            </div>

            <div class="all-products-group">
                {% for product in products %}
                    <div class="product-box menu-item" data-menu-item-id="{{ product.id }}">
                        <a href="{% url 'product_detail' slug=product.slug %}">
                            <div class="sellers-box-img" style="background: url({% if product.image1 %}{{ product.image1.url }}{% else %}{% static 'assets/fluffy-toy-texture-close-up.jpg' %}{% endif %});"> </div>
                        </a>
                        <div class="sellers-box-bottom">
                            <div class="sellers-box-t">
                                <div class="inline-detail"><span class="sellers-box-dollar">$</span><div class="sellers-box-price" data-menu-item-price="{{ product.price }}">{{ product.price }}</div></div>
                                <button id="confirm-add-to-cart" class="open-confirmation-popup" data-menu-item="{{ product.id }}"><i class="fa-solid fa-cart-shopping"></i></button>
                            </div>
                            <div class="sellers-box-b">
                                <div class="sellers-box-title" data-menu-item-name="{{ product.name}}"><a href="{% url 'product_detail' slug=product.slug %}">{{ product.name }}</a></div>
                            </div>
                        </div>
                        <div id="confirmation-popup-{{ product.id }}" class="popup">
                            <div class="popup-content">
                                <p>Are you sure you want to add this item to the cart?</p>
                                <button class="addToCartBtn popup-btn" data-menu-item="{{ product.id }}">Yes</button>
                                <button class="popup-btn cancel-add-to-cart">No</button>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>

            <!-- Pagination Controls -->
            <div class="pagination">
                <span class="step-links">
                    {% if page_obj.has_previous %}
                        <a class="pagination-link" href="?page=1{% if request.GET.brand %}&brand={{ request.GET.brand }}{% endif %}{% if request.GET.subcategory %}&subcategory={{ request.GET.subcategory }}{% endif %}{% if request.GET.sort_by %}&sort_by={{ request.GET.sort_by }}{% endif %}">&laquo; first</a>
                        <a class="pagination-link" href="?page={{ page_obj.previous_page_number }}{% if request.GET.brand %}&brand={{ request.GET.brand }}{% endif %}{% if request.GET.subcategory %}&subcategory={{ request.GET.subcategory }}{% endif %}{% if request.GET.sort_by %}&sort_by={{ request.GET.sort_by }}{% endif %}">previous</a>
                    {% endif %}

                    <span class="current-page">
                        Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
                    </span>

                    {% if page_obj.has_next %}
                        <a class="pagination-link" href="?page={{ page_obj.next_page_number }}{% if request.GET.brand %}&brand={{ request.GET.brand }}{% endif %}{% if request.GET.subcategory %}&subcategory={{ request.GET.subcategory }}{% endif %}{% if request.GET.sort_by %}&sort_by={{ request.GET.sort_by }}{% endif %}">next</a>
                        <a class="pagination-link" href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.brand %}&brand={{ request.GET.brand }}{% endif %}{% if request.GET.subcategory %}&subcategory={{ request.GET.subcategory }}{% endif %}{% if request.GET.sort_by %}&sort_by={{ request.GET.sort_by }}{% endif %}">last &raquo;</a>
                    {% endif %}
                </span>
            </div>

        </div>

    </div>
</div>

{% include 'include/footer.html' %}

{% endblock %}